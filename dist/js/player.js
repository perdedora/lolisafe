var lsKeys={},page={urlPrefix:null,urlIdentifier:null,urlInput:document.querySelector("#identifier"),reloadBtn:document.querySelector("#reloadBtn"),downloadBtn:document.querySelector("#downloadBtn"),uploadRoot:null,titleFormat:null,videoContainer:document.querySelector("#playerContainer"),id3Tags:document.querySelector("#id3Tags"),player:null,cloudflareErrors:{520:"Unknown Error",521:"Web Server Is Down",522:"Connection Timed Out",523:"Origin Is Unreachable",524:"A Timeout Occurred",525:"SSL Handshake Failed",526:"Invalid SSL Certificate",527:"Railgun Error",530:"Origin DNS Error"}};window.HELP_IMPROVE_VIDEOJS=!1,page.onError=function(e){console.error(e);var t=document.createElement("div");return t.innerHTML="\n    <p><code>"+e.toString()+"</code></p>\n    <p>Please check your console for more information.</p>\n  ",swal({title:"An error occurred!",icon:"error",content:t})},page.onAxiosError=function(e){if(!e.response)return page.onError(e);var t=page.cloudflareErrors[e.response.status]||e.response.statusText,o=e.response.data&&e.response.data.description?e.response.data.description:"";return swal(e.response.status+" "+t,o,"error")},page.toggleReloadBtn=function(e){e?(page.reloadBtn.classList.remove("is-loading"),page.reloadBtn.removeAttribute("disabled")):(page.reloadBtn.classList.add("is-loading"),page.reloadBtn.setAttribute("disabled","disabled"))},page.getMetadata=function(e,t){var o=window.origin+"/v/"+e+"/tags";axios.get(o).then((function(e){var o=e.data;if(o.success){document.querySelector(".message").classList.add("inplayer");var r=document.createElement("table"),a=o.common.track.no||"N/A",n=o.common.album||"N/A",i=o.common.artist||"N/A",l=o.common.title||"N/A",d=o.common.year||"N/A",s=o.format.codecProfile||"N/A",p=Math.round(o.format.sampleRate/100)/10+" hz"||"N/A",u=Math.round(o.format.bitrate/1e3)+" kbps"||"N/A",c=o.format.lossless?"Yes":"No",g=page.getPrettyBytes(parseInt(t)),h=o.common.encodersettings||"N/A";r.className="table is-narrow is-fullwidth",r.innerHTML='\n        <thead>\n        <tr>\n        <th>Artist</th>\n        <th>Album</th>\n        <th>Title</th>\n        <th>Track</th>\n        <th>Year</th>\n        <th>Codec Profile</th>\n        <th>Bitrate</th>\n        <th>Samplerate</th>\n        <th>Encoder</th>\n        <th>Lossless</th>\n        <th>Size</th>\n        </tr>\n        </thead>\n        <tbody id="table">\n        <tr>\n        <th>'+i+"</th>\n        <th>"+n+"</th>\n        <th>"+l+"</th>\n        <th>"+a+"</th>\n        <th>"+d+"</th>\n        <th>"+s+"</th>\n        <th>"+u+"</th>\n        <th>"+p+"</th>\n        <th>"+h+"</th>\n        <th>"+c+"</th>\n        <th>"+g+"</th>\n        </tr>\n        </tbody>";var m=o.common.picture?o.common.picture[0]:"N/A",v=page.bitArray(m.data,"data"),f=m.format,y=document.querySelector("#coverArt");y.querySelector("img").src="N/A"===m?"../images/unavailable.png":"data:"+f+";base64,"+window.btoa(v),y.querySelector("p").innerHTML=m.type||"",page.id3Tags.appendChild(r)}}))},page.reloadVideo=function(){if(page.urlInput.value){page.toggleReloadBtn(!1);var e=page.uploadRoot+"/"+page.urlInput.value;axios.head(e).then((function(t){if(![200,304].includes(t.status))return page.toggleReloadBtn(!0),page.onAxiosError(t);var o=t.headers["content-type"]||"",r=o.startsWith("video/"),a=o.startsWith("audio/");if(!r&&!a)return page.toggleReloadBtn(!0),swal("An error occurred!","The requested upload does not appear to be a media file.","error");page.urlIdentifier=page.urlInput.value,a&&page.getMetadata(page.urlIdentifier,t.headers["content-length"]),page.player&&(page.player.dispose(),page.videoContainer.innerHTML="");var n=document.createElement("video-js");n.id="video-js",n.className="video-js vjs-default-skin vjs-fluid ",n.className+=a?"vjs-audio-only-mode":"vjs-big-play-centered vjs-16-9",n.setAttribute("controls",!0),n.setAttribute("preload","auto"),page.videoContainer.appendChild(n);var i={language:"en",playbackRates:[.25,.5,.75,1,1.25,1.5,1.75,2],responsive:!0,plugins:{}};a&&(i.plugins.wavesurfer={responsive:!0}),page.player=videojs("video-js",i,(function(){var t="Using video.js "+videojs.VERSION;a&&(t+=" with videojs-wavesurfer "+videojs.getPluginVersion("wavesurfer")+" and wavesurfer.js "+WaveSurfer.VERSION),videojs.log(t),page.player.src({src:e,type:o})})),page.player.seekButtons({forward:10,back:10});var l=videojs.getComponent("Button"),d=function(){return page.player.loop()?"Disable loop":"Enable loop"},s=videojs.extend(l,{constructor:function(){l.apply(this,arguments),this.addClass("vjs-loop-button"),this.controlText(d())},handleClick:function(){page.player.loop(!page.player.loop()),this.toggleClass("vjs-loop-enabled",page.player.loop()),this.controlText(d())}});videojs.registerComponent("loopButton",s),page.player.getChild("controlBar").addChild("loopButton"),page.titleFormat&&(document.title=page.titleFormat.replace(/%identifier%/g,page.urlIdentifier)),page.downloadBtn&&page.downloadBtn.setAttribute("href",e),window.history.pushState(null,null,page.urlPrefix+page.urlIdentifier),page.toggleReloadBtn(!0)})).catch((function(e){page.toggleReloadBtn(!0),void 0!==e.response?page.onAxiosError(e):page.onError(e)}))}},window.addEventListener("DOMContentLoaded",(function(){var e=document.querySelector("#mainScript");if(e&&void 0!==e.dataset.uploadRoot){page.uploadRoot=e.dataset.uploadRoot,page.titleFormat=e.dataset.titleFormat;var t=window.location.protocol+"//"+window.location.host,o=window.location.pathname.match(/.*\/(.*)$/);if(!o||!o[1])return swal("An error occurred!","Failed to parse upload identifier from URL.","error");if(page.urlIdentifier=o[1],t+=window.location.pathname.substring(0,window.location.pathname.indexOf(o[1])),page.urlPrefix=t,page.urlInput){page.urlInput.value=page.urlIdentifier;var r=document.querySelector("#inputForm");r.addEventListener("submit",(function(e){e.preventDefault()})),page.videoContainer&&(page.reloadBtn=document.querySelector("#reloadBtn"),page.reloadBtn&&page.reloadBtn.addEventListener("click",(function(e){if(r.checkValidity()){var t=document.querySelector("#id3Tags > table");t&&t.remove(),page.reloadVideo()}})),page.reloadVideo())}}}));
//# sourceMappingURL=player.js.map
