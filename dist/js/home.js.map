{"version":3,"sources":["home.js"],"names":["const","lsKeys","token","chunkSize","parallelUploads","uploadsHistoryOrder","previewImages","fileLength","uploadAge","stripTags","page","localStorage","apiChecked","private","enableUserAccounts","maxSize","chunkSizeConfig","temporaryUploadAges","defaultTemporaryUploadAge","fileIdentifierLength","stripTagsConfig","album","maxSizeBytes","urlMaxSize","urlMaxSizeBytes","tabs","activeTab","albumSelect","albumSelectOnChange","previewTemplate","dropzone","clipboardJS","lazyLoad","urlsQueue","activeUrlsQueue","imageExts","videoExts","albumTitleMaxLength","albumDescMaxLength","cloudflareErrors","error","document","querySelector","classList","add","querySelectorAll","forEach","element","uploadButton","innerText","remove","addEventListener","window","location","reload","response","onAxiosError","onError","console","content","createElement","innerHTML","toString","swal","title","icon","statusText","status","description","data","success","apiVersion","match","src","text","buttons","confirm","closeModal","then","axios","get","onDownloadProgress","render","done","do","newsfeed","version","checkClientVersion","parseInt","getPrettyBytes","max","default","preparePage","catch","onInitError","verifyToken","prepareUpload","button","href","post","defaults","headers","common","Array","isArray","retentionPeriods","defaultRetentionPeriod","code","removeItem","authLink","setAttribute","value","prepareShareX","fetchAlbums","prepareUploadConfig","let","upDefault","getPrettyUploadAge","prepareDropzone","uploadUrls","event","addUrlsToQueue","tabsContainer","loop","i","id","dataset","tabContent","setActiveTab","push","tab","length","index","simple","albums","option","name","appendChild","previewNode","parentNode","removeChild","tabDiv","div","className","previewsContainer","Dropzone","body","url","paramName","clickable","maxFilesize","uploadMultiple","createImageThumbnails","autoProcessQueue","chunking","Boolean","parallelChunkUploads","timeout","init","this","on","file","previewElement","xhr","ontimeout","instances","getUploadingFiles","filter","instance","_handleUploadError","_uplSpeedCalc","lastSent","timestamp","Date","now","bytes","upload","chunked","setRequestHeader","chunks","progress","prettyBytesPerSec","total","Math","size","percentage","bytesSent","toFixed","upl","prefix","skipProgress","last","totalChunkCount","chunkIndex","elapsed","bytesPerSec","fullSec","splice","excessDuration","duration","files","updateTemplate","err","formatAxiosError","Error","test","updateTemplateIcon","chunksUploaded","uuid","original","type","albumid","filelength","age","striptags","urls","split","trim","firstChild","processUrlsQueue","shiftQueue","initUrlUpload","finishedUrlUpload","shift","templateElement","iconClass","iconElement","link","a","clipboard","clipboardText","parentElement","isVideo","startsWith","isAudio","embedPlayer","pathname","img","onerror","currentTarget","update","expirydate","expiryDate","getPrettyDate","createAlbum","cancel","download","checked","public","selected","fallback","min","config","siBytes","label","select","help","valueHandler","ampmTime","display","number","round","disabled","force","video","suffix","uploadFields","_default","stored","parseFloat","String","isNaN","form","preventDefault","configKeys","Object","keys","key","conf","field","parsed","find","sel","control","opts","j","opt","join","tmp","submit","checkValidity","elements","hours","minutes","days","items","clipboardData","originalEvent","item","kind","blob","getAsFile","File","addFile","cookieconsent","initialise","cookie","path","expiryDays","secure","protocol","palette","popup","background","theme","position","message","dismiss","checkIfPublic","ClipboardJS","timer","LazyLoad","elements_selector"],"mappings":"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","file":"home.js","sourcesContent":["/* global swal, axios, Dropzone, ClipboardJS, LazyLoad */\n\nconst lsKeys = {\n  token: 'token',\n  chunkSize: 'chunkSize',\n  parallelUploads: 'parallelUploads',\n  uploadsHistoryOrder: 'uploadsHistoryOrder',\n  previewImages: 'previewImages',\n  fileLength: 'fileLength',\n  uploadAge: 'uploadAge',\n  stripTags: 'stripTags'\n}\n\nconst page = {\n  // user token\n  token: localStorage[lsKeys.token],\n\n  // configs from api/check\n  apiChecked: false,\n  private: null,\n  enableUserAccounts: null,\n  maxSize: null,\n  chunkSizeConfig: null,\n  temporaryUploadAges: null,\n  defaultTemporaryUploadAge: null,\n  fileIdentifierLength: null,\n  stripTagsConfig: null,\n\n  // store album id that will be used with upload requests\n  album: null,\n\n  parallelUploads: null,\n  previewImages: null,\n  fileLength: null,\n  uploadAge: null,\n  stripTags: null,\n\n  maxSizeBytes: null,\n  urlMaxSize: null,\n  urlMaxSizeBytes: null,\n  chunkSize: null,\n\n  tabs: [],\n  activeTab: null,\n  albumSelect: null,\n  albumSelectOnChange: null,\n  previewTemplate: null,\n\n  dropzone: null,\n  clipboardJS: null,\n  lazyLoad: null,\n\n  // additional vars for url uploads\n  urlsQueue: [],\n  activeUrlsQueue: 0,\n\n  // Include BMP for uploads preview only, because the real images will be used instead of server-generated thumbnails\n  // Sharp is not capable of generating thumbnails for BMP images\n  imageExts: ['.gif', '.jpeg', '.jpg', '.png', '.svg', '.tif', '.tiff', '.webp', '.bmp'],\n  videoExts: ['.avi', '.m2ts', '.m4v', '.mkv', '.mov', '.mp4', '.webm', '.wmv'],\n\n  albumTitleMaxLength: 70,\n  albumDescMaxLength: 4000,\n\n  // Better Cloudflare errors\n  cloudflareErrors: {\n    520: 'Unknown Error',\n    521: 'Web Server Is Down',\n    522: 'Connection Timed Out',\n    523: 'Origin Is Unreachable',\n    524: 'A Timeout Occurred',\n    525: 'SSL Handshake Failed',\n    526: 'Invalid SSL Certificate',\n    527: 'Railgun Error',\n    530: 'Origin DNS Error'\n  }\n}\n\n// Handler for errors during initialization\npage.onInitError = error => {\n  // Hide these elements\n  document.querySelector('#albumDiv').classList.add('is-hidden')\n  document.querySelector('#tabs').classList.add('is-hidden')\n  document.querySelectorAll('.tab-content').forEach(element => {\n    return element.classList.add('is-hidden')\n  })\n\n  // Update upload button\n  const uploadButton = document.querySelector('#loginToUpload')\n  uploadButton.innerText = 'An error occurred. Try to reload?'\n  uploadButton.classList.remove('is-loading')\n  uploadButton.classList.remove('is-hidden')\n\n  uploadButton.addEventListener('click', () => {\n    window.location.reload()\n  })\n\n  if (!error) return\n  if (error.response) page.onAxiosError(error)\n  else page.onError(error)\n}\n\n// Handler for regular JS errors\npage.onError = error => {\n  console.error(error)\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p><code>${error.toString()}</code></p>\n    <p>Please check your console for more information.</p>\n  `\n  return swal({\n    title: 'An error occurred!',\n    icon: 'error',\n    content\n  })\n}\n\n// Handler for Axios errors\npage.onAxiosError = error => {\n  if (!error.response) {\n    return page.onError(error)\n  }\n\n  const statusText = page.cloudflareErrors[error.response.status] || error.response.statusText\n  const description = error.response.data && error.response.data.description\n    ? error.response.data.description\n    : 'There was an error with the request.\\nPlease check the console for more information.'\n\n  return swal(`${error.response.status} ${statusText}`, description, 'error')\n}\n\npage.formatAxiosError = error => {\n  const statusText = page.cloudflareErrors[error.response.status] || error.response.statusText\n\n  if (error.response.data && error.response.data.description) {\n    return error.response\n  } else {\n    const description = error.response\n      ? `${error.response.status} ${statusText}`\n      : error.toString()\n    return { data: { success: false, description } }\n  }\n}\n\npage.checkClientVersion = apiVersion => {\n  const self = document.querySelector('#mainScript')\n  const match = self.src.match(/\\?_=(\\d+)$/)\n  if (match && match[1] && match[1] !== apiVersion) {\n    return swal({\n      title: 'Update detected!',\n      text: 'Client assets have been updated. Reload to display the latest version?',\n      icon: 'info',\n      buttons: {\n        confirm: {\n          text: 'Reload',\n          closeModal: false\n        }\n      }\n    }).then(() => {\n      window.location.reload()\n    })\n  }\n}\n\npage.checkIfPublic = () => {\n  return axios.get('api/check', {\n    onDownloadProgress: () => {\n      // Only do render and/or newsfeed after this request has been initiated to avoid blocking\n      /* global render */\n      if (typeof render !== 'undefined' && !render.done) render.do()\n      /* global newsfeed */\n      if (typeof newsfeed !== 'undefined' && !newsfeed.done) newsfeed.do()\n      if (!page.apiChecked) page.apiChecked = true\n    }\n  }).then(response => {\n    if (response.data.version) {\n      page.checkClientVersion(response.data.version)\n    }\n\n    page.private = response.data.private\n    page.enableUserAccounts = response.data.enableUserAccounts\n\n    page.maxSize = parseInt(response.data.maxSize)\n    page.maxSizeBytes = page.maxSize * 1e6\n    document.querySelector('#maxSize > span').innerHTML = page.getPrettyBytes(page.maxSizeBytes)\n\n    page.chunkSizeConfig = {\n      max: (response.data.chunkSize && parseInt(response.data.chunkSize.max)) || 95,\n      default: response.data.chunkSize && parseInt(response.data.chunkSize.default)\n    }\n\n    page.temporaryUploadAges = response.data.temporaryUploadAges\n    page.defaultTemporaryUploadAge = response.data.defaultTemporaryUploadAge || null\n    page.fileIdentifierLength = response.data.fileIdentifierLength\n    page.stripTagsConfig = response.data.stripTags\n\n    return page.preparePage()\n  }).catch(page.onInitError)\n}\n\npage.preparePage = () => {\n  if (page.token) {\n    return page.verifyToken(page.token)\n  } else if (page.private) {\n    const button = document.querySelector('#loginToUpload')\n    button.href = 'auth'\n    button.classList.remove('is-loading')\n    if (page.enableUserAccounts) {\n      button.innerText = 'Anonymous upload is disabled.\\nLog in or register to upload.'\n    } else {\n      button.innerText = 'Running in private mode.\\nLog in to upload.'\n    }\n  } else {\n    return page.prepareUpload()\n  }\n}\n\npage.verifyToken = token => {\n  return axios.post('api/tokens/verify', { token }).then(response => {\n    axios.defaults.headers.common.token = token\n    localStorage[lsKeys.token] = token\n    page.token = token\n\n    // If user has its own retention periods array, override defaults\n    if (Array.isArray(response.data.retentionPeriods)) {\n      page.temporaryUploadAges = response.data.retentionPeriods\n      page.defaultTemporaryUploadAge = response.data.defaultRetentionPeriod\n    }\n\n    return page.prepareUpload()\n  }).catch(error => {\n    return page.onAxiosError(error).then(() => {\n      if (error.response.data && error.response.data.code === 10001) {\n        localStorage.removeItem(lsKeys.token)\n        window.location.reload()\n      } else {\n        page.onInitError()\n      }\n    })\n  })\n}\n\npage.prepareUpload = () => {\n  // I think this fits best here because we need to check for a valid token before we can get the albums\n  if (page.token) {\n    // Change /auth link to /dashboard\n    const authLink = document.querySelector('#linksColumn a[href=\"auth\"]')\n    if (authLink) authLink.setAttribute('href', 'dashboard')\n\n    // Display dashboard link once logged in\n    document.querySelector('#dashLink').classList.remove('is-hidden')\n\n    document.querySelector('#upAge').classList.remove('is-hidden')\n\n    // Display the album selection\n    document.querySelector('#albumDiv').classList.remove('is-hidden')\n\n    page.albumSelect = document.querySelector('#albumSelect')\n    page.albumSelectOnChange = () => {\n      page.album = parseInt(page.albumSelect.value)\n      // Re-generate ShareX config file\n      if (typeof page.prepareShareX === 'function') page.prepareShareX()\n    }\n    page.albumSelect.addEventListener('change', page.albumSelectOnChange)\n\n    // Fetch albums\n    page.fetchAlbums()\n  } else if (page.enableUserAccounts) {\n    document.querySelector('#loginLinkText').innerHTML = 'Create an account and keep track of your uploads'\n  }\n\n  // Prepare & generate config tab\n  page.prepareUploadConfig()\n\n  // Hide login button\n  document.querySelector('#loginToUpload').classList.add('is-hidden')\n\n  let upDefault = page.getPrettyUploadAge(document.querySelector('#uploadAge').value)\n  if (upDefault === 'default hours') upDefault = page.getPrettyUploadAge(page.defaultTemporaryUploadAge)\n\n  if (upDefault === 'Permanent') {\n    document.querySelector('#upAge > span').innerHTML = 'permanently'\n  } else {\n    document.querySelector('#upAge > span').innerHTML = `for ${upDefault}`\n  }\n\n  // Prepare & generate files upload tab\n  page.prepareDropzone()\n\n  // Generate ShareX config file\n  if (typeof page.prepareShareX === 'function') page.prepareShareX()\n\n  // Prepare urls upload tab\n  const urlMaxSize = document.querySelector('#urlMaxSize')\n  if (urlMaxSize) {\n    page.urlMaxSize = parseInt(urlMaxSize.innerHTML)\n    page.urlMaxSizeBytes = page.urlMaxSize * 1e6\n    urlMaxSize.innerHTML = page.getPrettyBytes(page.urlMaxSizeBytes)\n  }\n\n  const uploadUrls = document.querySelector('#uploadUrls')\n  if (uploadUrls) {\n    uploadUrls.addEventListener('click', event => {\n      page.addUrlsToQueue()\n    })\n  }\n\n  // Get all tabs\n  const tabsContainer = document.querySelector('#tabs')\n  const tabs = tabsContainer.querySelectorAll('li')\n  for (let i = 0; i < tabs.length; i++) {\n    const id = tabs[i].dataset.id\n    const tabContent = document.querySelector(`#${id}`)\n    if (!tabContent) continue\n\n    tabs[i].addEventListener('click', () => {\n      page.setActiveTab(i)\n    })\n    page.tabs.push({ tab: tabs[i], content: tabContent })\n  }\n\n  // Set first valid tab as the default active tab\n  if (page.tabs.length) {\n    page.setActiveTab(0)\n    tabsContainer.classList.remove('is-hidden')\n  }\n}\n\npage.setActiveTab = index => {\n  for (let i = 0; i < page.tabs.length; i++) {\n    if (i === index) {\n      page.tabs[i].tab.classList.add('is-active')\n      page.tabs[i].content.classList.remove('is-hidden')\n      page.activeTab = index\n    } else {\n      page.tabs[i].tab.classList.remove('is-active')\n      page.tabs[i].content.classList.add('is-hidden')\n    }\n  }\n}\n\npage.fetchAlbums = () => {\n  return axios.get('api/albums', { headers: { simple: '1' } }).then(response => {\n    if (response.data.success === false) {\n      return swal('An error occurred!', response.data.description, 'error')\n    }\n\n    // Create an option for each album\n    if (Array.isArray(response.data.albums) && response.data.albums.length) {\n      for (let i = 0; i < response.data.albums.length; i++) {\n        const album = response.data.albums[i]\n        const option = document.createElement('option')\n        option.value = album.id\n        option.innerHTML = album.name\n        page.albumSelect.appendChild(option)\n      }\n    }\n  }).catch(page.onInitError)\n}\n\npage.prepareDropzone = () => {\n  // Parse template element\n  const previewNode = document.querySelector('#tpl')\n  page.previewTemplate = previewNode.innerHTML\n  previewNode.parentNode.removeChild(previewNode)\n\n  // Generate files upload tab\n  const tabDiv = document.querySelector('#tab-files')\n  const div = document.createElement('div')\n  div.className = 'control is-expanded'\n  div.innerHTML = `\n    <div id=\"dropzone\" class=\"button is-danger is-outlined is-fullwidth is-unselectable\">\n      <span class=\"icon\">\n        <i class=\"icon-upload-cloud\"></i>\n      </span>\n      <span>Click here or drag & drop files</span>\n    </div>\n  `\n  tabDiv.querySelector('.dz-container').appendChild(div)\n\n  const previewsContainer = tabDiv.querySelector('#tab-files .field.uploads')\n\n  page.dropzone = new Dropzone(document.body, {\n    url: 'api/upload',\n    paramName: 'files[]',\n    clickable: tabDiv.querySelector('#dropzone'),\n    maxFilesize: page.maxSizeBytes / 1024 / 1024, // this option expects MiB\n    parallelUploads: page.parallelUploads,\n    uploadMultiple: false,\n    previewsContainer,\n    previewTemplate: page.previewTemplate,\n    createImageThumbnails: false,\n    autoProcessQueue: true,\n    headers: { token: page.token },\n    chunking: Boolean(page.chunkSize),\n    chunkSize: page.chunkSize * 1e6, // this option expects Bytes\n    // Lolisafe cannot handle parallel chunked uploads\n    // due to technical reasons involving how we optimize I/O performance\n    parallelChunkUploads: false,\n    timeout: 0,\n\n    init () {\n      this.on('addedfile', file => {\n        // Set active tab to file uploads, if necessary\n        if (page.activeTab !== 0) page.setActiveTab(0)\n\n        // Add file entry\n        tabDiv.querySelector('.uploads').classList.remove('is-hidden')\n\n        file.previewElement.querySelector('.name').innerHTML = file.name\n        file.previewElement.querySelector('.descriptive-progress').innerHTML = 'Waiting in queue\\u2026'\n      })\n\n      this.on('sending', (file, xhr) => {\n        // Add timeout listener (hacky method due to lack of built-in timeout handler)\n        if (!xhr.ontimeout) {\n          xhr.ontimeout = () => {\n            const instances = page.dropzone.getUploadingFiles()\n              .filter(instance => instance.xhr === xhr)\n            page.dropzone._handleUploadError(instances, xhr, 'Connection timed out. Try to reduce upload chunk size.')\n          }\n        }\n\n        // Attach necessary data for initial upload speed calculation\n        if (typeof xhr._uplSpeedCalc === 'undefined') {\n          xhr._uplSpeedCalc = {\n            lastSent: 0,\n            data: [{ timestamp: Date.now(), bytes: 0 }]\n          }\n        }\n\n        // If not chunked uploads, add extra headers\n        if (!file.upload.chunked) {\n          if (page.album !== null) xhr.setRequestHeader('albumid', page.album)\n          if (page.fileLength !== null) xhr.setRequestHeader('filelength', page.fileLength)\n          if (page.uploadAge !== null) xhr.setRequestHeader('age', page.uploadAge)\n          if (page.stripTags !== null) xhr.setRequestHeader('striptags', page.stripTags)\n        }\n\n        if (!file.upload.chunked) {\n          file.previewElement.querySelector('.descriptive-progress').innerHTML = 'Uploading\\u2026'\n        } else if (file.upload.chunks.length === 1) {\n          file.previewElement.querySelector('.descriptive-progress').innerHTML = `Uploading chunk 1/${file.upload.totalChunkCount}\\u2026`\n        }\n      })\n\n      // Update descriptive progress\n      this.on('uploadprogress', (file, progress) => {\n        // Total bytes will eventually be bigger than file size when chunked\n        const total = Math.max(file.size, file.upload.total)\n        const percentage = (file.upload.bytesSent / total * 100).toFixed(0)\n\n        const upl = file.upload.chunked\n          ? file.upload.chunks[file.upload.chunks.length - 1]\n          : file.upload\n        const xhr = upl.xhr || file.xhr\n\n        let prefix = 'Uploading\\u2026'\n        let skipProgress = false\n        if (file.upload.chunked) {\n          const done = upl.bytesSent === upl.total\n          const last = file.upload.chunks.length === file.upload.totalChunkCount\n          let chunkIndex = file.upload.chunks.length\n          if (done && !last) {\n            chunkIndex++\n            skipProgress = true\n          }\n          prefix = `Uploading chunk ${chunkIndex}/${file.upload.totalChunkCount}\\u2026`\n        }\n\n        // Real-time upload speed calculation\n        let prettyBytesPerSec\n        if (!skipProgress) {\n          const now = Date.now()\n          const bytesSent = upl.bytesSent - xhr._uplSpeedCalc.lastSent\n\n          // Push data of current iteration\n          xhr._uplSpeedCalc.lastSent = upl.bytesSent\n          xhr._uplSpeedCalc.data.push({ timestamp: now, bytes: bytesSent })\n\n          // Wait till at least the 2nd iteration (3 data including initial data)\n          const length = xhr._uplSpeedCalc.data.length\n          if (length > 2) {\n            // Calculate using data from all iterations\n            let elapsed = 0\n            let bytesPerSec = 0\n            let fullSec = false\n            let i = length - 1 // Always start with 2nd from last item\n            while (i--) {\n              // Splice data of unrequired iterations\n              if (fullSec) {\n                xhr._uplSpeedCalc.data.splice(i, 1)\n                continue\n              }\n              // Sum data\n              elapsed = now - xhr._uplSpeedCalc.data[i].timestamp\n              if (elapsed > 1000) {\n                const excessDuration = elapsed - 1000\n                const newerIterationElapsed = now - xhr._uplSpeedCalc.data[i + 1].timestamp\n                const duration = elapsed - newerIterationElapsed\n                const fragment = (duration - excessDuration) / duration * xhr._uplSpeedCalc.data[i + 1].bytes\n                bytesPerSec += fragment\n                fullSec = true\n              } else {\n                bytesPerSec += xhr._uplSpeedCalc.data[i + 1].bytes\n              }\n            }\n\n            // If not enough data\n            if (!fullSec) bytesPerSec = 1000 / elapsed * bytesPerSec\n\n            // Get pretty bytes\n            prettyBytesPerSec = page.getPrettyBytes(bytesPerSec)\n          }\n        }\n\n        file.previewElement.querySelector('.descriptive-progress').innerHTML =\n          `${prefix} ${percentage}%${prettyBytesPerSec ? ` at ${prettyBytesPerSec}/s` : ''}`\n      })\n\n      this.on('success', (file, data) => {\n        if (!data) return\n        file.previewElement.querySelector('.descriptive-progress').classList.add('is-hidden')\n\n        if (data.success === false) {\n          file.previewElement.querySelector('.error').innerHTML = data.description\n          file.previewElement.querySelector('.error').classList.remove('is-hidden')\n        }\n\n        if (Array.isArray(data.files) && data.files[0]) {\n          page.updateTemplate(file, data.files[0])\n        }\n      })\n\n      this.on('error', (file, error, xhr) => {\n        let err = error\n        if (typeof error === 'object' && error.description) {\n          err = error.description\n        } else if (xhr) {\n          const formatted = page.formatAxiosError({\n            response: {\n              status: xhr.status,\n              statusText: xhr.statusText\n            }\n          })\n          err = formatted.data.description\n        } else if (error instanceof Error) {\n          err = error.toString()\n        }\n\n        // Clean up file size errors\n        if (/^File is too big/.test(err) || /File too large/.test(err)) {\n          err = `File too large (${page.getPrettyBytes(file.size)}).`\n        }\n\n        file.previewElement.querySelector('.descriptive-progress').classList.add('is-hidden')\n\n        file.previewElement.querySelector('.error').innerHTML = err\n        file.previewElement.querySelector('.error').classList.remove('is-hidden')\n\n        page.updateTemplateIcon(file.previewElement, 'icon-block')\n      })\n    },\n\n    chunksUploaded (file, done) {\n      file.previewElement.querySelector('.descriptive-progress').innerHTML =\n        `Rebuilding ${file.upload.totalChunkCount} chunks\\u2026`\n\n      axios.post('api/upload/finishchunks', {\n        // This API supports an array of multiple files\n        files: [{\n          uuid: file.upload.uuid,\n          original: file.name,\n          type: file.type,\n          size: file.size,\n          albumid: page.album,\n          filelength: page.fileLength,\n          age: page.uploadAge\n        }]\n      }, {\n        headers: {\n          // Unlike the options above (e.g. albumid, filelength, etc.),\n          // strip tags cannot yet be configured per file with this API\n          striptags: page.stripTags || ''\n        }\n      }).catch(error => page.formatAxiosError(error)).then(response => {\n        file.previewElement.querySelector('.descriptive-progress').classList.add('is-hidden')\n\n        if (response.data.success === false) {\n          file.previewElement.querySelector('.error').innerHTML = response.data.description\n          file.previewElement.querySelector('.error').classList.remove('is-hidden')\n\n          page.updateTemplateIcon(file.previewElement, 'icon-block')\n        }\n\n        if (response.data.files && response.data.files[0]) {\n          page.updateTemplate(file, response.data.files[0])\n        }\n\n        done()\n      })\n    }\n  })\n}\n\npage.addUrlsToQueue = () => {\n  const urls = document.querySelector('#urls').value\n    .split(/\\r?\\n/)\n    .filter(url => {\n      return url.trim().length\n    })\n\n  if (!urls.length) {\n    return swal('An error occurred!', 'You have not entered any URLs.', 'error')\n  }\n\n  const tabDiv = document.querySelector('#tab-urls')\n  tabDiv.querySelector('.uploads').classList.remove('is-hidden')\n\n  for (let i = 0; i < urls.length; i++) {\n    const previewTemplate = document.createElement('template')\n    previewTemplate.innerHTML = page.previewTemplate.trim()\n\n    const previewElement = previewTemplate.content.firstChild\n    previewElement.querySelector('.name').innerHTML = urls[i]\n    previewElement.querySelector('.descriptive-progress').innerHTML = 'Waiting in queue\\u2026'\n\n    const previewsContainer = tabDiv.querySelector('.uploads')\n    previewsContainer.appendChild(previewElement)\n\n    page.urlsQueue.push({\n      url: urls[i],\n      previewElement\n    })\n  }\n\n  page.processUrlsQueue()\n  document.querySelector('#urls').value = ''\n}\n\npage.processUrlsQueue = () => {\n  if (!page.urlsQueue.length) return\n\n  function finishedUrlUpload (file, data) {\n    file.previewElement.querySelector('.descriptive-progress').classList.add('is-hidden')\n\n    if (data.success === false) {\n      const match = data.description.match(/ over limit: (\\d+)$/)\n      if (match && match[1]) {\n        data.description = `File exceeded limit of ${page.getPrettyBytes(match[1])}.`\n      }\n\n      file.previewElement.querySelector('.error').innerHTML = data.description\n      file.previewElement.querySelector('.error').classList.remove('is-hidden')\n\n      page.updateTemplateIcon(file.previewElement, 'icon-block')\n    }\n\n    if (Array.isArray(data.files) && data.files[0]) {\n      page.updateTemplate(file, data.files[0])\n    }\n\n    page.activeUrlsQueue--\n    return shiftQueue()\n  }\n\n  function initUrlUpload (file) {\n    file.previewElement.querySelector('.descriptive-progress').innerHTML =\n      'Waiting for server to fetch URL\\u2026'\n\n    return axios.post('api/upload', {\n      urls: [file.url]\n    }, {\n      headers: {\n        albumid: page.album || '',\n        age: page.uploadAge || '',\n        filelength: page.fileLength || ''\n      }\n    }).catch(error => page.formatAxiosError(error)).then(response => {\n      return finishedUrlUpload(file, response.data)\n    })\n  }\n\n  function shiftQueue () {\n    while (page.urlsQueue.length && (page.activeUrlsQueue < page.parallelUploads)) {\n      page.activeUrlsQueue++\n      initUrlUpload(page.urlsQueue.shift())\n    }\n  }\n\n  return shiftQueue()\n}\n\npage.updateTemplateIcon = (templateElement, iconClass) => {\n  const iconElement = templateElement.querySelector('.icon')\n  if (!iconElement) return\n\n  iconElement.classList.add(iconClass)\n  iconElement.classList.remove('is-hidden')\n}\n\npage.updateTemplate = (file, response) => {\n  if (!response.url) return\n\n  const link = file.previewElement.querySelector('.link')\n  const a = link.querySelector('a')\n  const clipboard = file.previewElement.querySelector('.clipboard-mobile > .clipboard-js')\n  let url = response.url\n  if (!/^https?:\\/\\//i.test(url)) {\n    url = `${window.location.origin}/${url}`\n  }\n  a.href = a.innerHTML = clipboard.dataset.clipboardText = url\n\n  link.classList.remove('is-hidden')\n  clipboard.parentElement.classList.remove('is-hidden')\n\n  const isVideo = file.type.startsWith('video/')\n  const isAudio = file.type.startsWith('audio/')\n  if (isVideo || isAudio) {\n    const embedPlayer = file.previewElement.querySelector('.embedPlayer')\n    embedPlayer.querySelector('a').href = '/v' + a.pathname\n    embedPlayer.classList.remove('is-hidden')\n    embedPlayer.querySelector('i').className = isAudio ? 'icon-audio' : 'icon-video'\n  }\n\n  if (file.type.startsWith('image/')) {\n    if (page.previewImages) {\n      const img = file.previewElement.querySelector('img')\n      img.setAttribute('alt', response.name || '')\n      img.dataset.src = response.url\n      img.classList.remove('is-hidden')\n      img.onerror = event => {\n        // Hide image elements that fail to load\n        // Consequently include WEBP in browsers that do not have WEBP support (e.g. IE)\n        event.currentTarget.classList.add('is-hidden')\n        page.updateTemplateIcon(file.previewElement, 'icon-picture')\n      }\n      page.lazyLoad.update(file.previewElement.querySelectorAll('img'))\n    } else {\n      page.updateTemplateIcon(file.previewElement, 'icon-picture')\n    }\n  } else if (isVideo) {\n    page.updateTemplateIcon(file.previewElement, 'icon-video')\n  } else if (isAudio) {\n    page.updateTemplateIcon(file.previewElement, 'icon-audio')\n  } else {\n    page.updateTemplateIcon(file.previewElement, 'icon-doc-inv')\n  }\n\n  if (response.expirydate) {\n    const expiryDate = file.previewElement.querySelector('.expiry-date')\n    expiryDate.dataset.timestamp = response.expirydate\n    expiryDate.innerHTML = `EXP: ${page.getPrettyDate(new Date(response.expirydate * 1000))}`\n    expiryDate.classList.remove('is-hidden')\n  }\n}\n\npage.createAlbum = () => {\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <div class=\"controls\">\n        <input id=\"swalName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\">\n      </div>\n      <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <textarea id=\"swalDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"2\" maxlength=\"${page.albumDescMaxLength}\"></textarea>\n      </div>\n      <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalDownload\" type=\"checkbox\" checked>\n          Enable download\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalPublic\" type=\"checkbox\" checked>\n          Enable public link\n        </label>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Create new album',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(value => {\n    if (!value) return\n\n    const name = document.querySelector('#swalName').value.trim()\n    axios.post('api/albums', {\n      name,\n      description: document.querySelector('#swalDescription').value.trim(),\n      download: document.querySelector('#swalDownload').checked,\n      public: document.querySelector('#swalPublic').checked\n    }).then(response => {\n      if (response.data.success === false) {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n      const option = document.createElement('option')\n      page.albumSelect.appendChild(option)\n      option.value = response.data.id\n      option.innerHTML = name\n      option.selected = true\n      page.albumSelectOnChange()\n\n      swal('Woohoo!', 'Album was created successfully.', 'success')\n    }).catch(page.onError)\n  })\n}\n\npage.prepareUploadConfig = () => {\n  // This object should only be used to set fallback values for page[key]\n  // (essentially for page[key] properties that explicitly need to be set as something)\n  // As for default values in the Config tab (which will not set page[key]),\n  // check out number.default property of each config\n  const fallback = {\n    chunkSize: page.chunkSizeConfig.default,\n    parallelUploads: 2\n  }\n\n  const temporaryUploadAges = Array.isArray(page.temporaryUploadAges) &&\n    page.temporaryUploadAges.length\n  const fileIdentifierLength = page.fileIdentifierLength &&\n    typeof page.fileIdentifierLength.min === 'number' &&\n    typeof page.fileIdentifierLength.max === 'number'\n\n  const config = {\n    siBytes: {\n      label: 'File size display',\n      select: [\n        { value: 'default', text: '1000 B = 1 kB = 1 Kilobyte' },\n        { value: '0', text: '1024 B = 1 KiB = 1 Kibibyte' }\n      ],\n      help: 'This will be used in our homepage, dashboard, and album public pages.',\n      valueHandler () {} // Do nothing\n    },\n    ampmTime: {\n      label: 'Show AM/PM on date',\n      select: [\n        { value: 'default', text: 'No' },\n        { value: '1', text: 'Yes' }\n      ],\n      help: 'This will be used in our homepage and dashboard.',\n      valueHandler () {} // Do nothing\n    },\n    fileLength: {\n      display: fileIdentifierLength,\n      label: 'File identifier length',\n      number: fileIdentifierLength\n        ? {\n            min: page.fileIdentifierLength.min,\n            max: page.fileIdentifierLength.max,\n            default: page.fileIdentifierLength.default,\n            round: true\n          }\n        : void 0,\n      help: true, // true means auto-generated, for number-based configs only\n      disabled: fileIdentifierLength && page.fileIdentifierLength.force\n    },\n    uploadAge: {\n      display: temporaryUploadAges,\n      label: 'Upload age',\n      select: [],\n      help: 'Whether to automatically delete your uploads after a certain amount of time.'\n    },\n    stripTags: {\n      display: page.stripTagsConfig,\n      label: 'Strip tags',\n      select: page.stripTagsConfig\n        ? [\n            { value: page.stripTagsConfig.default ? 'default' : '1', text: 'Yes' },\n            { value: page.stripTagsConfig.default ? '0' : 'default', text: 'No' }\n          ]\n        : null,\n      help: `Whether to strip tags (e.g. EXIF) from your uploads.<br>\n        This only applies to regular image${page.stripTagsConfig && page.stripTagsConfig.video ? ' and video' : ''} uploads (i.e. not URL uploads).`,\n      disabled: page.stripTagsConfig && page.stripTagsConfig.force\n    },\n    chunkSize: {\n      display: Boolean(page.chunkSizeConfig.default),\n      label: 'Upload chunk size (MB)',\n      number: {\n        min: 1,\n        max: page.chunkSizeConfig.max,\n        default: fallback.chunkSize,\n        suffix: ' MB',\n        round: true\n      },\n      help: true\n    },\n    parallelUploads: {\n      label: 'Parallel uploads',\n      number: {\n        min: 1,\n        max: 10,\n        default: fallback.parallelUploads,\n        round: true\n      },\n      help: true\n    },\n    uploadsHistoryOrder: {\n      label: 'Uploads history order',\n      select: [\n        { value: 'default', text: 'Older files on top' },\n        { value: '0', text: 'Newer files on top' }\n      ],\n      help: `\"Newer files on top\" will use a CSS technique, which unfortunately come with <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/flex-direction#Accessibility_concerns\" target=\"_blank\" rel=\"noopener\">some undesirable side effects</a>.<br>\n        This also affects text selection, such as when trying to select text from top to bottom will result in them being selected from bottom to top instead, and vice versa.`,\n      valueHandler (value) {\n        if (value === '0') {\n          const uploadFields = document.querySelectorAll('.tab-content > .uploads')\n          for (let i = 0; i < uploadFields.length; i++) {\n            uploadFields[i].classList.add('is-reversed')\n          }\n        }\n      }\n    },\n    previewImages: {\n      label: 'Load images for preview',\n      select: [\n        { value: 'default', text: 'Yes' },\n        { value: '0', text: 'No' }\n      ],\n      help: 'By default, uploaded images will be loaded as their previews.',\n      valueHandler (value) {\n        page.previewImages = value !== '0'\n      }\n    }\n  }\n\n  if (temporaryUploadAges) {\n    const _default = page.defaultTemporaryUploadAge === null\n      ? page.temporaryUploadAges[0]\n      : page.defaultTemporaryUploadAge\n    const stored = parseFloat(localStorage[lsKeys.uploadAge])\n    for (let i = 0; i < page.temporaryUploadAges.length; i++) {\n      const age = page.temporaryUploadAges[i]\n      config.uploadAge.select.push({\n        value: age === _default ? 'default' : String(age),\n        text: page.getPrettyUploadAge(age)\n      })\n      if (age === stored) {\n        config.uploadAge.value = stored\n      }\n    }\n  }\n\n  if (fileIdentifierLength) {\n    const stored = parseInt(localStorage[lsKeys.fileLength])\n    if (!page.fileIdentifierLength.force &&\n      !isNaN(stored) &&\n      stored >= page.fileIdentifierLength.min &&\n      stored <= page.fileIdentifierLength.max) {\n      config.fileLength.value = stored\n    }\n  }\n\n  const tabContent = document.querySelector('#tab-config')\n  const form = document.createElement('form')\n  form.addEventListener('submit', event => event.preventDefault())\n\n  const configKeys = Object.keys(config)\n  for (let i = 0; i < configKeys.length; i++) {\n    const key = configKeys[i]\n    const conf = config[key]\n\n    // Skip only if display attribute is explicitly set to false\n    if (conf.display === false) continue\n\n    const field = document.createElement('div')\n    field.className = 'field'\n\n    let value\n    if (!conf.disabled) {\n      if (typeof conf.value !== 'undefined') {\n        value = conf.value\n      } else if (typeof conf.number !== 'undefined') {\n        const parsed = parseInt(localStorage[lsKeys[key]])\n        if (!isNaN(parsed) && parsed <= conf.number.max && parsed >= conf.number.min) {\n          value = parsed\n        }\n      } else {\n        const stored = localStorage[lsKeys[key]]\n        if (Array.isArray(conf.select)) {\n          if (conf.select.find(sel => sel.value === stored)) {\n            value = stored\n          }\n        } else {\n          value = stored\n        }\n      }\n\n      // If valueHandler function exists, defer to the function,\n      // otherwise pass value to global page object\n      if (typeof conf.valueHandler === 'function') {\n        conf.valueHandler(value)\n      } else if (typeof value !== 'undefined') {\n        page[key] = value\n      } else if (typeof fallback[key] !== 'undefined') {\n        page[key] = fallback[key]\n      }\n    }\n\n    let control\n    if (Array.isArray(conf.select)) {\n      control = document.createElement('div')\n      control.className = 'select is-fullwidth'\n\n      const opts = []\n      for (let j = 0; j < conf.select.length; j++) {\n        const opt = conf.select[j]\n        const selected = (value && (opt.value === String(value))) ||\n          (typeof value === 'undefined' && opt.value === 'default')\n        opts.push(`\n          <option value=\"${opt.value}\"${selected ? ' selected' : ''}>\n            ${opt.text}${opt.value === 'default' ? ' (default)' : ''}\n          </option>\n        `)\n      }\n\n      control.innerHTML = `\n        <select id=\"${key}\">\n          ${opts.join('\\n')}\n        </select>\n      `\n    } else if (conf.number) {\n      control = document.createElement('input')\n      control.id = control.name = key\n      control.className = 'input is-fullwidth'\n      control.type = 'number'\n\n      if (typeof conf.number.min !== 'undefined') control.min = conf.number.min\n      if (typeof conf.number.max !== 'undefined') control.max = conf.number.max\n      if (typeof value === 'number') control.value = value\n      else if (typeof conf.number.default !== 'undefined') control.value = conf.number.default\n    }\n\n    let help\n    if (conf.disabled) {\n      if (Array.isArray(conf.select)) {\n        control.querySelector('select').disabled = conf.disabled\n      } else {\n        control.disabled = conf.disabled\n      }\n      help = 'This option is currently not configurable.'\n    } else if (typeof conf.help === 'string') {\n      help = conf.help\n    } else if (conf.help === true && typeof conf.number !== 'undefined') {\n      const tmp = []\n\n      if (typeof conf.number.default !== 'undefined') {\n        tmp.push(`Default is ${conf.number.default}${conf.number.suffix || ''}.`)\n      }\n      if (typeof conf.number.min !== 'undefined') {\n        tmp.push(`Min is ${conf.number.min}${conf.number.suffix || ''}.`)\n      }\n      if (typeof conf.number.max !== 'undefined') {\n        tmp.push(`Max is ${conf.number.max}${conf.number.suffix || ''}.`)\n      }\n\n      help = tmp.join(' ')\n    }\n\n    field.innerHTML = `\n      <label class=\"label\">${conf.label}</label>\n      <div class=\"control\"></div>\n      ${help ? `<p class=\"help\">${help}</p>` : ''}\n    `\n    field.querySelector('div.control').appendChild(control)\n\n    form.appendChild(field)\n  }\n\n  const submit = document.createElement('div')\n  submit.className = 'field'\n  submit.innerHTML = `\n    <p class=\"control\">\n      <button id=\"saveConfig\" type=\"submit\" class=\"button is-danger is-outlined is-fullwidth\">\n        <span class=\"icon\">\n          <i class=\"icon-floppy\"></i>\n        </span>\n        <span>Save & reload</span>\n      </button>\n    </p>\n    <p class=\"help\">\n      This configuration will only be used in this browser.<br>\n      After reloading the page, some of them will also be applied to the ShareX config that you can download by clicking on the ShareX icon below.\n    </p>\n  `\n\n  form.appendChild(submit)\n  form.querySelector('#saveConfig').addEventListener('click', () => {\n    if (!form.checkValidity()) return\n\n    const keys = Object.keys(config)\n      .filter(key => config[key].display !== false && config[key].disabled !== true)\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i]\n\n      let value\n      if (typeof config[key].select !== 'undefined') {\n        if (form.elements[key].value !== 'default') {\n          value = form.elements[key].value\n        }\n      } else if (typeof config[key].number !== 'undefined') {\n        const parsed = parseInt(form.elements[key].value)\n        if (!isNaN(parsed) && parsed !== config[key].number.default) {\n          value = Math.min(Math.max(parsed, config[key].number.min), config[key].number.max)\n        }\n      }\n\n      if (typeof value !== 'undefined') localStorage[lsKeys[key]] = value\n      else localStorage.removeItem(lsKeys[key])\n    }\n\n    swal({\n      title: 'Woohoo!',\n      text: 'Configuration saved into this browser.',\n      icon: 'success'\n    }).then(() => {\n      window.location.reload()\n    })\n  })\n\n  tabContent.appendChild(form)\n}\n\npage.getPrettyUploadAge = hours => {\n  if (hours === 0) {\n    return 'Permanent'\n  } else if (hours < 1) {\n    const minutes = hours * 60\n    return `${minutes} minute${minutes === 1 ? '' : 's'}`\n  } else if (hours >= 24) {\n    const days = hours / 24\n    return `${days} day${days === 1 ? '' : 's'}`\n  } else {\n    return `${hours} hour${hours === 1 ? '' : 's'}`\n  }\n}\n\n// Handle image paste event\nwindow.addEventListener('paste', event => {\n  const items = (event.clipboardData || event.originalEvent.clipboardData).items\n  const index = Object.keys(items)\n  for (let i = 0; i < index.length; i++) {\n    const item = items[index[i]]\n    if (item.kind === 'file') {\n      const blob = item.getAsFile()\n      /* eslint-disable-next-line compat/compat */\n      const file = new File([blob], `pasted-image.${blob.type.match(/(?:[^/]*\\/)([^;]*)/)[1]}`, {\n        type: blob.type\n      })\n      page.dropzone.addFile(file)\n    }\n  }\n})\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  if (window.cookieconsent) {\n    window.cookieconsent.initialise({\n      cookie: {\n        name: 'cookieconsent_status',\n        path: window.location.pathname,\n        expiryDays: 730,\n        secure: window.location.protocol === 'https:'\n      },\n      palette: {\n        popup: {\n          background: '#282828',\n          text: '#eff0f1'\n        },\n        button: {\n          background: '#209cee',\n          text: '#ffffff'\n        }\n      },\n      theme: 'classic',\n      position: 'bottom-left',\n      content: {\n        message: 'We use cookies to offer you a better browsing experience and to analyze our traffic. You consent to our cookies if you continue to use this website.',\n        dismiss: 'Got it!',\n        link: 'Details in our Cookie Policy',\n        href: 'cookiepolicy'\n      }\n    })\n  }\n\n  page.checkIfPublic()\n\n  page.clipboardJS = new ClipboardJS('.clipboard-js')\n\n  page.clipboardJS.on('success', () => {\n    return swal('', 'The link has been copied to clipboard.', 'success', {\n      buttons: false,\n      timer: 1500\n    })\n  })\n\n  page.clipboardJS.on('error', page.onError)\n\n  page.lazyLoad = new LazyLoad({\n    elements_selector: '.field.uploads img'\n  })\n\n  document.querySelector('#createAlbum').addEventListener('click', () => {\n    page.createAlbum()\n  })\n})\n"]}