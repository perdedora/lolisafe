{"version":3,"sources":["player.js"],"names":["const","lsKeys","page","urlPrefix","urlIdentifier","urlInput","document","querySelector","reloadBtn","downloadBtn","uploadRoot","titleFormat","videoContainer","id3Tags","player","cloudflareErrors","window","HELP_IMPROVE_VIDEOJS","onError","error","console","content","createElement","innerHTML","toString","swal","title","icon","onAxiosError","response","statusText","status","description","data","toggleReloadBtn","enabled","classList","remove","removeAttribute","add","setAttribute","getMetadata","file","sizeFile","fileSrc","axios","get","then","metaData","success","tableMetaData","trackNo","common","track","no","album","artist","trackTitle","year","codecProfile","format","sampleRate","Math","round","bitRate","bitrate","lossless","size","getPrettyBytes","parseInt","encoderSettings","encodersettings","className","pictureSelect","picture","coverArtBit","bitArray","coverArtType","coverArt","src","btoa","type","appendChild","reloadVideo","value","head","includes","headers","isvideo","startsWith","isaudio","dispose","videoElement","id","options","language","playbackRates","responsive","plugins","wavesurfer","videojs","let","message","getPluginVersion","WaveSurfer","log","seekButtons","forward","back","videoJSButton","getComponent","loopButtonText","loop","loopButton","extend","constructor","apply","this","arguments","addClass","controlText","handleClick","toggleClass","registerComponent","getChild","addChild","replace","history","pushState","catch","addEventListener","mainScript","dataset","location","protocol","host","match","pathname","substring","indexOf","form","event","preventDefault","checkValidity","reloadTags"],"mappings":"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","file":"player.js","sourcesContent":["/* global swal, axios, videojs, WaveSurfer */\n\n// eslint-disable-next-line no-unused-vars\nconst lsKeys = {}\n\nconst page = {\n  urlPrefix: null,\n  urlIdentifier: null,\n\n  urlInput: document.querySelector('#identifier'),\n  reloadBtn: document.querySelector('#reloadBtn'),\n  downloadBtn: document.querySelector('#downloadBtn'),\n  uploadRoot: null,\n  titleFormat: null,\n\n  videoContainer: document.querySelector('#playerContainer'),\n  id3Tags: document.querySelector('#id3Tags'),\n  player: null,\n\n  // Better Cloudflare errors\n  cloudflareErrors: {\n    520: 'Unknown Error',\n    521: 'Web Server Is Down',\n    522: 'Connection Timed Out',\n    523: 'Origin Is Unreachable',\n    524: 'A Timeout Occurred',\n    525: 'SSL Handshake Failed',\n    526: 'Invalid SSL Certificate',\n    527: 'Railgun Error',\n    530: 'Origin DNS Error'\n  }\n}\n\n// Disable video.js telemetry (should already be disabled by default since v7 though)\nwindow.HELP_IMPROVE_VIDEOJS = false\n\n// Handler for regular JS errors\npage.onError = error => {\n  console.error(error)\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p><code>${error.toString()}</code></p>\n    <p>Please check your console for more information.</p>\n  `\n  return swal({\n    title: 'An error occurred!',\n    icon: 'error',\n    content\n  })\n}\n\n// Handler for Axios errors\npage.onAxiosError = error => {\n  if (!error.response) {\n    return page.onError(error)\n  }\n\n  const statusText = page.cloudflareErrors[error.response.status] || error.response.statusText\n\n  const description = error.response.data && error.response.data.description\n    ? error.response.data.description\n    : ''\n  return swal(`${error.response.status} ${statusText}`, description, 'error')\n}\n\npage.toggleReloadBtn = enabled => {\n  if (enabled) {\n    page.reloadBtn.classList.remove('is-loading')\n    page.reloadBtn.removeAttribute('disabled')\n  } else {\n    page.reloadBtn.classList.add('is-loading')\n    page.reloadBtn.setAttribute('disabled', 'disabled')\n  }\n}\n\npage.getMetadata = (file, sizeFile) => {\n  const fileSrc = `${window.origin}/v/${file}/tags`\n  axios.get(fileSrc).then(response => {\n    const metaData = response.data\n    if (metaData.success) {\n      const messageBox = document.querySelector('.message')\n      messageBox.classList.add('inplayer')\n      const tableMetaData = document.createElement('table')\n      const trackNo = metaData.common.track.no || 'N/A'\n      const album = metaData.common.album || 'N/A'\n      const artist = metaData.common.artist || 'N/A'\n      const trackTitle = metaData.common.title || 'N/A'\n      const year = metaData.common.year || 'N/A'\n      const codecProfile = metaData.format.codecProfile || 'N/A'\n      const sampleRate = `${Math.round(metaData.format.sampleRate / 100) / 10} hz` || 'N/A'\n      const bitRate = `${Math.round(metaData.format.bitrate / 1000)} kbps` || 'N/A'\n      const lossless = metaData.format.lossless ? 'Yes' : 'No'\n      const size = page.getPrettyBytes(parseInt(sizeFile))\n      const encoderSettings = metaData.common.encodersettings || 'N/A'\n      tableMetaData.className = 'table is-narrow is-fullwidth'\n      tableMetaData.innerHTML = `\n        <thead>\n        <tr>\n        <th>Artist</th>\n        <th>Album</th>\n        <th>Title</th>\n        <th>Track</th>\n        <th>Year</th>\n        <th>Codec Profile</th>\n        <th>Bitrate</th>\n        <th>Samplerate</th>\n        <th>Encoder</th>\n        <th>Lossless</th>\n        <th>Size</th>\n        </tr>\n        </thead>\n        <tbody id=\"table\">\n        <tr>\n        <th>${artist}</th>\n        <th>${album}</th>\n        <th>${trackTitle}</th>\n        <th>${trackNo}</th>\n        <th>${year}</th>\n        <th>${codecProfile}</th>\n        <th>${bitRate}</th>\n        <th>${sampleRate}</th>\n        <th>${encoderSettings}</th>\n        <th>${lossless}</th>\n        <th>${size}</th>\n        </tr>\n        </tbody>`\n      const pictureSelect = metaData.common.picture ? metaData.common.picture[0] : 'N/A'\n      const coverArtBit = page.bitArray(pictureSelect.data, 'data')\n      const coverArtType = pictureSelect.format\n      const coverArt = document.querySelector('#coverArt')\n      coverArt.querySelector('img').src = pictureSelect === 'N/A' ? '../images/unavailable.png' : `data:${coverArtType};base64,${window.btoa(coverArtBit)}`\n      coverArt.querySelector('p').innerHTML = pictureSelect.type || ''\n\n      page.id3Tags.appendChild(tableMetaData)\n    }\n  })\n}\n\npage.reloadVideo = () => {\n  if (!page.urlInput.value) return\n\n  page.toggleReloadBtn(false)\n  const src = `${page.uploadRoot}/${page.urlInput.value}`\n\n  axios.head(src).then(response => {\n    if (![200, 304].includes(response.status)) {\n      page.toggleReloadBtn(true)\n      return page.onAxiosError(response)\n    }\n\n    const type = response.headers['content-type'] || ''\n    const isvideo = type.startsWith('video/')\n    const isaudio = type.startsWith('audio/')\n    if (!isvideo && !isaudio) {\n      page.toggleReloadBtn(true)\n      return swal('An error occurred!', 'The requested upload does not appear to be a media file.', 'error')\n    }\n\n    page.urlIdentifier = page.urlInput.value\n\n    if (isaudio) page.getMetadata(page.urlIdentifier, response.headers['content-length'])\n\n    if (page.player) {\n      page.player.dispose()\n      page.videoContainer.innerHTML = ''\n    }\n\n    const videoElement = document.createElement('video-js')\n    videoElement.id = 'video-js'\n    videoElement.className = 'video-js vjs-default-skin vjs-fluid '\n    videoElement.className += isaudio ? 'vjs-audio-only-mode' : 'vjs-big-play-centered vjs-16-9'\n    videoElement.setAttribute('controls', true)\n    videoElement.setAttribute('preload', 'auto')\n\n    page.videoContainer.appendChild(videoElement)\n\n    const options = {\n      language: 'en',\n      playbackRates: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2],\n      responsive: true,\n      plugins: {}\n    }\n\n    if (isaudio) {\n      options.plugins.wavesurfer = {\n        responsive: true\n      }\n    }\n\n    page.player = videojs('video-js', options, () => {\n      let message = `Using video.js ${videojs.VERSION}`\n      if (isaudio) {\n        message += ` with videojs-wavesurfer ${videojs.getPluginVersion('wavesurfer')} and wavesurfer.js ${WaveSurfer.VERSION}`\n      }\n      videojs.log(message)\n      page.player.src({ src, type })\n    })\n    page.player.seekButtons({ forward: 10, back: 10 })\n\n    const videoJSButton = videojs.getComponent('Button')\n    const loopButtonText = () => page.player.loop()\n      ? 'Disable loop'\n      : 'Enable loop'\n    const loopButton = videojs.extend(videoJSButton, {\n      constructor () {\n        videoJSButton.apply(this, arguments)\n        this.addClass('vjs-loop-button')\n        this.controlText(loopButtonText())\n      },\n      handleClick () {\n        page.player.loop(!page.player.loop())\n        this.toggleClass('vjs-loop-enabled', page.player.loop())\n        this.controlText(loopButtonText())\n      }\n    })\n    videojs.registerComponent('loopButton', loopButton)\n    page.player.getChild('controlBar').addChild('loopButton')\n\n    if (page.titleFormat) {\n      document.title = page.titleFormat.replace(/%identifier%/g, page.urlIdentifier)\n    }\n\n    if (page.downloadBtn) {\n      page.downloadBtn.setAttribute('href', src)\n    }\n\n    window.history.pushState(null, null, page.urlPrefix + page.urlIdentifier)\n    page.toggleReloadBtn(true)\n  }).catch(error => {\n    page.toggleReloadBtn(true)\n    if (typeof error.response !== 'undefined') page.onAxiosError(error)\n    else page.onError(error)\n  })\n}\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  const mainScript = document.querySelector('#mainScript')\n  if (!mainScript || typeof mainScript.dataset.uploadRoot === 'undefined') return\n\n  page.uploadRoot = mainScript.dataset.uploadRoot\n  page.titleFormat = mainScript.dataset.titleFormat\n\n  let urlPrefix = window.location.protocol + '//' + window.location.host\n  const match = window.location.pathname.match(/.*\\/(.*)$/)\n  if (!match || !match[1]) {\n    return swal('An error occurred!', 'Failed to parse upload identifier from URL.', 'error')\n  }\n\n  page.urlIdentifier = match[1]\n  urlPrefix += window.location.pathname.substring(0, window.location.pathname.indexOf(match[1]))\n  page.urlPrefix = urlPrefix\n\n  if (!page.urlInput) return\n  page.urlInput.value = page.urlIdentifier\n\n  // Prevent default form's submit actio\n  const form = document.querySelector('#inputForm')\n  form.addEventListener('submit', event => {\n    event.preventDefault()\n  })\n\n  if (!page.videoContainer) return\n\n  page.reloadBtn = document.querySelector('#reloadBtn')\n  if (page.reloadBtn) {\n    page.reloadBtn.addEventListener('click', event => {\n      if (!form.checkValidity()) return\n      const reloadTags = document.querySelector('#id3Tags > table')\n      if (reloadTags) reloadTags.remove()\n      page.reloadVideo()\n    })\n  }\n\n  page.reloadVideo()\n})\n"]}